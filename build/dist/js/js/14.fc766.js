webpackJsonp([14],{"962x":function(e,s){},KjIH:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o=t("3cXf"),n=t.n(o),i=t("gpPJ"),l=t("CKVb"),a=t("fvyU"),c=t("IXui"),u=t("o+C2"),d=t("pxwZ"),r=t("8e4C"),p=t("7Eps"),h=t("VKKs"),g=t("/sQn"),v=t("ZpOu"),m=(i.a,l.a,a.a,c.a,u.a,p.a,g.a,v.a,{name:"DriverScene",components:{Cell:i.a,Group:l.a,XInput:a.a,XButton:c.a,PopupPicker:u.a,BillCode:p.a,AddImg:g.a,NoPermission:v.a},data:function(){return{role:"",billCode:"",disabled:!0,businessScene:["请选择"],businessScenes:[["请选择","仓库","基站","移动签收","直运签收"]],businessSceneValues:{"仓库":11,"基站":12,"移动签收":31,"直运签收":32},sceneLevel:["请选择"],sceneLevels:[["请选择","地面","上楼","上山","其他"]],sceneLevelValues:{"地面":13,"上楼":14,"上山":15,"其他":16},address:"",longitude:"",latitude:"",photos:[],serverIds:"",uploadDoneNum:0}},mounted:function(){this.$store.commit("updateTitle",r.s),this.common.wxConfig(!1,["getLocation","chooseImage","previewImage","uploadImage","scanQRCode"]);var e=h.b.get(r.b);null!==e&&(this.role=e.role),"司机"!==this.role&&"中通员工"!==this.role||this.init()},methods:{init:function(){var e=this;wx.ready(function(){console.log("suceess"),e.$store.commit("updateLoading",!0),setTimeout(function(){e.getCurrentLocation()},300)}),wx.error(function(e){console.log(n()(e))})},billCodeEvent:function(e){console.log(e),this.billCode=e},getCurrentLocation:function(){var e=this;wx.getLocation({type:"gcj02",success:function(s){e.$store.commit("updateLoading",!1),r.c&&console.log("res="+n()(s));var t=new qq.maps.LatLng(s.latitude,s.longitude);e.getGeverseGeocoder(t)}})},getGeverseGeocoder:function(e){var s=this;new qq.maps.Geocoder({complete:function(e){console.log(n()(e)),s.address=e.detail.address.substring(2),s.longitude=e.detail.location.lng,s.latitude=e.detail.location.lat}}).getAddress(e)},businessChange:function(e){console.log(e)},sceneChange:function(e){console.log(e[0]),"请选择"!==this.businessScene[0]&&"请选择"!==this.sceneLevel[0]?this.disabled=!1:this.disabled=!0},getPhotos:function(e){this.photos=e,console.log("photos="+e.length)},complete:function(){this.photos[0];this.photos.length>0?this.uploadToWeixin():this.postDriverScene()},uploadToWeixin:function(){if(this.photos.length===this.uploadDoneNum)this.uploadDoneNum=0,this.serverIds=this.serverIds.substring(0,this.serverIds.length-1),this.postDriverScene();else{var e=this;wx.uploadImage({localId:e.photos[this.uploadDoneNum]+"",isShowProgressTips:1,success:function(s){var t=s.serverId;e.uploadDoneNum++,e.$vux.toast.text("已上传"+e.uploadDoneNum+"张","middle"),e.serverIds=""+e.serverIds+t+",",setTimeout(e.uploadToWeixin(),300)}})}},postDriverScene:function(){var e=this,s={bill_code:this.billCode,biz_scenename:this.businessScene[0],biz_scene:this.businessSceneValues[this.businessScene[0]],spec_scenename:this.sceneLevel[0],spec_scene:this.sceneLevelValues[this.sceneLevel[0]],address:this.address,longitude:this.longitude,latitude:this.latitude,images:this.serverIds};r.c&&console.log("params="+n()(s)),this.$store.commit("updateLoading",!0),d.a.addSceneinfo(s).then(function(s){e.$store.commit("updateLoading",!1),0===s.code?e.$vux.toast.text("操作成功.","middle"):e.$vux.toast.text(s.message,"middle")},function(s){e.$store.commit("updateLoading",!1)})}}}),b={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"driver-scene"},["司机"===e.role||"中通员工"===e.role?t("div",[t("group",{attrs:{"label-width":"5.5em","label-margin-right":"2em","label-align":"left"}},[t("bill-code",{on:{"on-billCode":e.billCodeEvent}}),e._v(" "),t("popup-picker",{attrs:{title:"业务场景","popup-title":"业务场景",data:e.businessScenes,placeholder:"请选择"},on:{"on-change":e.businessChange},model:{value:e.businessScene,callback:function(s){e.businessScene=s},expression:"businessScene"}}),e._v(" "),t("popup-picker",{attrs:{title:"场景难度","popup-title":"场景难度",data:e.sceneLevels,placeholder:"请选择"},on:{"on-change":e.sceneChange},model:{value:e.sceneLevel,callback:function(s){e.sceneLevel=s},expression:"sceneLevel"}}),e._v(" "),t("cell",{attrs:{title:"当前地址",value:e.address}}),e._v(" "),t("cell",{attrs:{title:"当前经度",value:e.longitude}}),e._v(" "),t("cell",{attrs:{title:"当前纬度",value:e.latitude}})],1),e._v(" "),t("add-img",{on:{"on-getPhotos":e.getPhotos}}),e._v(" "),t("div",{staticStyle:{padding:"25px"}},[t("x-button",{attrs:{disabled:e.disabled,type:"primary","action-type":"submit"},nativeOn:{click:function(s){return e.complete(s)}}},[e._v("完成")])],1)],1):t("no-permission")],1)},staticRenderFns:[]};var f=t("C7Lr")(m,b,!1,function(e){t("962x")},null,null);s.default=f.exports}});