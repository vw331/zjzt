webpackJsonp([16],{"32y+":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("3cXf"),o=i.n(s),a=i("gpPJ"),r=i("CKVb"),l=i("fvyU"),n=i("S9nr"),u=i("IXui"),d=i("pxwZ"),m=(i("8e4C"),i("VKKs"),i("/sQn")),h=(a.a,r.a,l.a,n.a,u.a,m.a,{name:"UpdateStatus",components:{Cell:a.a,Group:r.a,XInput:l.a,Datetime:n.a,XButton:u.a,AddImg:m.a},data:function(){return{billCode:"",status:"",driverName:"",driverMobile:"",time:"请选择",hourList:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],minuteList:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"],remark:"",serverIds:"",uploadDoneNum:0,photos:[]}},created:function(){this.time=this.common.getNowTime(),this.status=this.$route.query.status,this.$store.commit("updateTitle",this.getTitle()),this.billCode=this.$route.query.billCode,this.driverName=this.$route.query.driverName,this.driverMobile=this.$route.query.driverMobile,this.common.wxConfig(!1,["chooseImage","previewImage","uploadImage"])},methods:{getTitle:function(){var t="";switch(this.status){case"W":t="车辆到库";break;case"E":t="提货确认";break;case"L":t="装车完成";break;case"T":t="发运";break;case"D":t="运抵"}return t},timeChange:function(t){this.time=t},getPhotos:function(t){this.photos=t,console.log("photos="+t.length)},complete:function(){this.photos[0];this.photos.length>0?this.uploadToWeixin():this.postStatus()},uploadToWeixin:function(){if(this.photos.length===this.uploadDoneNum)this.uploadDoneNum=0,this.serverIds=this.serverIds.substring(0,this.serverIds.length-1),this.postStatus();else{var t=this;wx.uploadImage({localId:t.photos[this.uploadDoneNum]+"",isShowProgressTips:1,success:function(e){var i=e.serverId;t.uploadDoneNum++,t.$vux.toast.text("已上传"+t.uploadDoneNum+"张","middle"),t.serverIds=""+t.serverIds+i+",",setTimeout(t.uploadToWeixin(),300)}})}},postStatus:function(){var t=this,e={bill_code:this.billCode,status:this.status,time:this.time+":00",message:this.remark,images:this.serverIds};console.log("params="+o()(e)),this.$store.commit("updateLoading",!0),d.a.updateStatus(e).then(function(e){t.$store.commit("updateLoading",!1),0===e.code?(t.$vux.toast.text("操作成功.","middle"),t.$router.go(-1)):t.$vux.toast.text(e.message,"middle")},function(e){t.$store.commit("updateLoading",!1)})}}}),c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"update-status"},[i("group",{attrs:{"label-width":"5.5em","label-margin-right":"2em","label-align":"left"}},[i("cell",{attrs:{title:"调度单编号",value:t.billCode}}),t._v(" "),i("cell",{attrs:{title:"调度单状态",value:t.getTitle()}}),t._v(" "),i("cell",{attrs:{title:"司机",value:t.driverName}}),t._v(" "),i("cell",{attrs:{title:"手机号码",value:t.driverMobile}}),t._v(" "),i("datetime",{attrs:{format:"YYYY-MM-DD HH:mm","hour-list":t.hourList,"minute-list":t.minuteList,title:"选择时间"},on:{"on-change":t.timeChange},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}}),t._v(" "),i("x-input",{attrs:{title:"备注",placeholder:"输入备注信息","placeholder-align":"right","text-align":"right"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1),t._v(" "),i("add-img",{on:{"on-getPhotos":t.getPhotos}}),t._v(" "),i("div",{staticStyle:{padding:"25px"}},[i("x-button",{attrs:{type:"primary","action-type":"submit"},nativeOn:{click:function(e){return t.complete(e)}}},[t._v("完成")])],1)],1)},staticRenderFns:[]};var p=i("C7Lr")(h,c,!1,function(t){i("KRSP")},null,null);e.default=p.exports},KRSP:function(t,e){}});