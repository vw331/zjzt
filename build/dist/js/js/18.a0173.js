webpackJsonp([18],{"8UpR":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("3cXf"),s=i.n(o),a=i("gpPJ"),n=i("CKVb"),r=i("fvyU"),l=i("S9nr"),u=i("IXui"),d=i("pxwZ"),c=i("8e4C"),m=i("VKKs"),p=i("/sQn"),g=(a.a,n.a,r.a,l.a,u.a,p.a,{name:"UpdateOnroad",components:{Cell:a.a,Group:n.a,XInput:r.a,Datetime:l.a,XButton:u.a,AddImg:p.a},data:function(){return{billCode:"",driverName:"",driverMobile:"",time:"",province:"",city:"",district:"",address:"",longitude:"",latitude:"",hourList:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],minuteList:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"],photos:[],serverIds:"",uploadDoneNum:0}},created:function(){this.$store.commit("updateTitle",c.r),this.time=this.common.getNowTime()},mounted:function(){wx.config({debug:!1,appId:m.a.get("appId"),timestamp:m.a.get("timestamp"),nonceStr:m.a.get("nonceStr"),signature:m.a.get("signature"),jsApiList:["getLocation","chooseImage","previewImage","uploadImage"]}),this.init()},methods:{init:function(){var t=this;wx.ready(function(){console.log("suceess"),t.$store.commit("updateLoading",!0),setTimeout(function(){t.getCurrentLocation()},300)}),wx.error(function(t){console.log(s()(t))}),this.billCode=this.$route.query.billCode,this.driverName=this.$route.query.driverName,this.driverMobile=this.$route.query.driverMobile},getCurrentLocation:function(){var t=this;wx.getLocation({type:"gcj02",success:function(e){t.$store.commit("updateLoading",!1),c.c&&console.log("res="+s()(e));var i=new qq.maps.LatLng(e.latitude,e.longitude);t.getGeverseGeocoder(i)}})},getGeverseGeocoder:function(t){var e=this;new qq.maps.Geocoder({complete:function(t){console.log(s()(t));var i=t.detail.addressComponents;e.province=i.province,e.city=i.city,e.district=i.district,e.address=t.detail.address.substring(2),e.longitude=t.detail.location.lng,e.latitude=t.detail.location.lat}}).getAddress(t)},timeChange:function(t){this.time=t},getPhotos:function(t){this.photos=t,console.log("photos="+t.length)},complete:function(){this.photos[0];this.photos.length>0?this.uploadToWeixin():this.postStatus()},uploadToWeixin:function(){if(this.photos.length===this.uploadDoneNum)this.uploadDoneNum=0,this.serverIds=this.serverIds.substring(0,this.serverIds.length-1),this.postStatus();else{var t=this;wx.uploadImage({localId:t.photos[this.uploadDoneNum]+"",isShowProgressTips:1,success:function(e){var i=e.serverId;t.uploadDoneNum++,t.$vux.toast.text("已上传"+t.uploadDoneNum+"张","middle"),t.serverIds=""+t.serverIds+i+",",setTimeout(t.uploadToWeixin(),300)}})}},postStatus:function(){var t=this,e={bill_code:this.billCode,province:this.province,city:this.city,area:this.area,address:this.address,longitude:this.longitude,latitude:this.latitude,status:"T",time:this.time+":00",images:this.serverIds};c.c&&console.log("params="+s()(e)),this.$store.commit("updateLoading",!0),d.a.updateStatus(e).then(function(e){t.$store.commit("updateLoading",!1),0===e.code?(t.$vux.toast.text("操作成功.","middle"),t.$router.go(-1)):t.$vux.toast.text(e.message,"middle")},function(e){t.$store.commit("updateLoading",!1)})}}}),h={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"update-onroad"},[i("group",{attrs:{"label-width":"5.5em","label-margin-right":"2em","label-align":"left"}},[i("cell",{attrs:{title:"调度单编号",value:t.billCode}}),t._v(" "),i("cell",{attrs:{title:"当前省份",value:t.province}}),t._v(" "),i("cell",{attrs:{title:"当前城市",value:t.city}}),t._v(" "),i("cell",{attrs:{title:"当前区县",value:t.district}}),t._v(" "),i("cell",{attrs:{title:"当前地址",value:t.address}}),t._v(" "),i("cell",{attrs:{title:"当前经度",value:t.longitude}}),t._v(" "),i("cell",{attrs:{title:"当前纬度",value:t.latitude}}),t._v(" "),i("cell",{attrs:{title:"司机",value:t.driverName}}),t._v(" "),i("cell",{attrs:{title:"手机号码",value:t.driverMobile}}),t._v(" "),i("datetime",{attrs:{format:"YYYY-MM-DD HH:mm","hour-list":t.hourList,"minute-list":t.minuteList,title:"选择时间"},on:{"on-change":t.timeChange},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),t._v(" "),i("add-img",{on:{"on-getPhotos":t.getPhotos}}),t._v(" "),i("div",{staticStyle:{padding:"25px"}},[i("x-button",{attrs:{type:"primary","action-type":"submit"},nativeOn:{click:function(e){return t.complete(e)}}},[t._v("完成")])],1)],1)},staticRenderFns:[]};var v=i("C7Lr")(g,h,!1,function(t){i("MCgq")},null,null);e.default=v.exports},MCgq:function(t,e){}});